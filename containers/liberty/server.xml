<?xml version="1.0" encoding="UTF-8"?>
<server description="Containerized Open Liberty">
    <featureManager>
        <feature>restfulWS-3.1</feature>
        <feature>jsonb-3.0</feature>
        <feature>cdi-4.0</feature>
        <feature>mpHealth-4.0</feature>
        <feature>mpMetrics-5.0</feature>
        <feature>mpConfig-3.0</feature>
        <feature>jdbc-4.3</feature>
        <feature>ssl-1.0</feature>
    </featureManager>

    <httpEndpoint id="defaultHttpEndpoint" host="*"
                  httpPort="9080"
                  httpsPort="9443">
        <!-- Limit POST body size to 1MB to prevent DoS attacks -->
        <httpOptions maxPostSize="1048576" />
    </httpEndpoint>

    <!-- ===================================================================== -->
    <!-- SSL/TLS Configuration                                                 -->
    <!-- ===================================================================== -->
    <!--
         HTTPS on port 9443 requires a keystore to be mounted at runtime.

         For container deployments:
         1. Mount your PKCS12 keystore to /config/resources/security/key.p12
         2. Set environment variable KEYSTORE_PASSWORD with the keystore password

         Example:
           podman run -d \
             -v /path/to/key.p12:/config/resources/security/key.p12:ro \
             -e KEYSTORE_PASSWORD=your_password \
             liberty-app:1.0.0

         For development/testing without HTTPS, access the application via port 9080.
         Liberty will start successfully but HTTPS will be unavailable until configured.
    -->
    <ssl id="defaultSSLConfig" keyStoreRef="defaultKeyStore" />

    <keyStore id="defaultKeyStore"
              location="${server.config.dir}/resources/security/key.p12"
              password="${env.KEYSTORE_PASSWORD}"
              type="PKCS12" />

    <mpHealth authentication="false"/>
    <mpMetrics authentication="false"/>

    <logging consoleLogLevel="INFO" consoleFormat="JSON"/>

    <!-- Auto-deploy WAR files from apps directory -->
    <webApplication id="sample-app" location="sample-app.war" contextRoot="/sample-app"/>
</server>
