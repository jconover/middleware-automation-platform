# Open Liberty Container - Podman Optimized
# Build: podman build -t liberty-app:1.0.0 -f Containerfile .
# Run:   podman run -d -p 9080:9080 -p 9443:9443 liberty-app:1.0.0

FROM icr.io/appcafe/open-liberty:kernel-slim-java17-openj9-ubi

LABEL maintainer="Justin" \
      version="1.0.0" \
      description="Open Liberty Application Server"

# Install curl for health checks (run as root, then switch back)
USER root
RUN yum install -y curl && yum clean all
USER 1001

# Copy server configuration
COPY --chown=1001:0 server.xml /config/server.xml
COPY --chown=1001:0 jvm.options /config/jvm.options

# Install features
RUN features.sh

# Copy application
COPY --chown=1001:0 apps/*.war /config/apps/

# Health check
HEALTHCHECK --interval=30s --timeout=10s --start-period=60s --retries=3 \
    CMD curl -f http://localhost:9080/health/ready || exit 1

EXPOSE 9080 9443
