# =============================================================================
# Kustomization for KEDA-based Autoscaling
# =============================================================================
# Alternative to prometheus-adapter for custom metrics HPA.
# KEDA provides event-driven autoscaling with native Prometheus integration.
#
# IMPORTANT: Choose ONE scaling approach:
#   Option A: prometheus-adapter + liberty-hpa.yaml (standard HPA)
#   Option B: KEDA ScaledObject (this directory)
#
# Do NOT use both simultaneously as they will conflict.
#
# Prerequisites:
#   - KEDA installed in the cluster
#     helm repo add kedacore https://kedacore.github.io/charts
#     helm repo update
#     helm install keda kedacore/keda --namespace keda --create-namespace
#   - Prometheus accessible at prometheus-operated.monitoring.svc:9090
#   - Liberty ServiceMonitor collecting metrics
#
# Usage:
#   # If using KEDA instead of prometheus-adapter:
#   # 1. Remove liberty-hpa.yaml from base kustomization.yaml
#   # 2. Apply KEDA resources:
#   kubectl apply -k kubernetes/base/keda/
#
# Verification:
#   # Check KEDA is running
#   kubectl get pods -n keda
#
#   # Check ScaledObject status
#   kubectl get scaledobject liberty-scaledobject
#   kubectl describe scaledobject liberty-scaledobject
#
#   # Check the HPA created by KEDA
#   kubectl get hpa keda-hpa-liberty-scaledobject
#
#   # View scaling events
#   kubectl get events --field-selector involvedObject.name=liberty-scaledobject
#
# When to use KEDA over prometheus-adapter:
#   - Need scale-to-zero capability (non-production)
#   - Complex scaling logic with multiple metric sources
#   - Event-driven scaling (queues, streams, etc.)
#   - Simpler deployment (no APIService registration needed)
#
# When to use prometheus-adapter:
#   - Standard HPA experience preferred
#   - Already using prometheus-adapter for other workloads
#   - Minimal additional dependencies desired
# =============================================================================
---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: liberty-keda

commonLabels:
  app.kubernetes.io/part-of: middleware-platform
  app.kubernetes.io/managed-by: kustomize
  autoscaling.method: keda

resources:
  - liberty-scaledobject.yaml
