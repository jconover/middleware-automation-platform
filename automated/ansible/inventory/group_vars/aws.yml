---
# =============================================================================
# Group Variables for AWS Hosts
# =============================================================================

# Environment identifier
env_name: production
cloud_provider: aws

# Liberty settings (same as dev, but can be overridden)
liberty_version: "24.0.0.1"
liberty_install_dir: /opt/ibm/wlp
liberty_user: liberty
liberty_http_port: 9080
liberty_https_port: 9443
liberty_java_version: "17"

# JVM settings for production (can use more memory on t3.small)
liberty_jvm_heap_min: 512m
liberty_jvm_heap_max: 1536m

# =============================================================================
# SECURITY-CRITICAL VARIABLES (REQUIRED FOR AWS/PRODUCTION)
# =============================================================================
# These passwords MUST be defined via Ansible Vault. The playbook will fail
# with a security error if these variables are missing or use weak values.
#
# Requirements:
#   - liberty_keystore_password: minimum 16 characters
#   - liberty_admin_password: minimum 12 characters
#   - Neither may use common defaults (changeit, admin, password, etc.)
#
# To create encrypted values:
#   ansible-vault encrypt_string 'YourSecureKeystorePassword!' --name 'liberty_keystore_password'
#   ansible-vault encrypt_string 'YourSecureAdminPass!' --name 'liberty_admin_password'
#
# Store the encrypted output in: group_vars/aws/vault.yml
# =============================================================================
# liberty_keystore_password: !vault |
#   $ANSIBLE_VAULT;1.1;AES256
#   [your encrypted keystore password here]
#
# liberty_admin_password: !vault |
#   $ANSIBLE_VAULT;1.1;AES256
#   [your encrypted admin password here]
#
# liberty_admin_user: admin
# =============================================================================

# AWS-specific Liberty features
liberty_features:
  - restfulWS-3.1
  - jsonb-3.0
  - cdi-4.0
  - mpHealth-4.0
  - mpMetrics-5.0
  - jdbc-4.3
  - ssl-1.0
  - mpConfig-3.0

# Database connection (RDS)
# These should be overridden by Terraform outputs or environment variables
db_type: postgresql
db_port: 5432
db_name: appdb

# Redis connection (ElastiCache)
redis_port: 6379

# Monitoring settings
# In AWS, Prometheus can scrape via private IPs
prometheus_liberty_targets: "{{ groups['liberty_servers'] | map('extract', hostvars, 'ansible_host') | map('regex_replace', '$', ':9080') | list }}"

# SSH settings for AWS
# Using accept-new to accept first connection but detect MITM on subsequent connections
ansible_ssh_common_args: '-o StrictHostKeyChecking=accept-new'

# CloudWatch agent (optional)
install_cloudwatch_agent: true
